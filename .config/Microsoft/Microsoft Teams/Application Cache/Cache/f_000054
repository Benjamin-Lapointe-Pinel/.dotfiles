webpackJsonp([13],{2211:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n(2212),n(2216),n(2219),n(2221),n(2222)},2212:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2213),i=n(2215),o=function(){function e(e,t,n,r,i,o){this.loggingService=e,this.$window=t,this.constants=n,this.utilityService=r,this.desktopUtilityService=i,this.eventingService=o,this.logger=e.newLogger("ExperienceContainerFactory")}return e.$inject=["loggingService","$window","constants","utilityService","desktopUtilityService","eventingService"],e.prototype.generateContainerId=function(){return"experience-renderer-"+this.utilityService.generateUUID()},e.prototype.create=function(e){this.logger.log("creating experience container");var t=this.generateContainerId(),n=this.desktopUtilityService.isElectron(),o=this.loggingService.findScenario(this.constants.experienceContainers.scenarios.init);o&&o.mark(this.constants.experienceContainers.step.ecfCreate,{isElectron:n});var a=/^https:\/\/local.teams.office.com/.test(e.url);return this.loggingService.setContext("experienceContainerMode",a?"development":"production"),n?(this.logger.info("Creating WebView experience container: "+t,e),new i.WebViewExperienceContainer(this.loggingService,t,e,this.$window,this.constants,this.eventingService)):(this.logger.info("Creating IFrame experience container: "+t,e),new r.IframeExperienceContainer(this.loggingService,t,e,this.$window,this.constants))},e}();t.ExperienceContainerFactory=o,angular.module("teamspace.experienceContainerFactory",["teamspace.loggingService","teamspace.constants","teamspace.utilityService","teamspace.desktopUtilityService"]).service("experienceContainerFactory",o)},2213:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var o=n(33),a=n(89),s=function(e){function t(t,n,r,i,o){var a=e.call(this,t.newLogger("IframeExperienceContainer"),n,r,o,i)||this,s=new URL(r.url);return a.origin=s.origin,a}return r(t,e),t.prototype.createElement=function(e){var t=this,n=a.htmlFactory.createIframe(this.elementId);return n.src=e,n.setAttribute("class","embedded-electron-webview embedded-page-content"),this.$window.addEventListener("message",function(e){var r=e.source,i=e.origin,a=e.data,s=a.channel,c=a.payload;r===n.contentWindow&&i===t.origin&&s===t.constants.multiWindow.channel&&c&&(c.eventId===o.ChildWindowEventRequest.CoreInitialized&&(t._loaded=!0),t.publish(c.eventId,c.payload))}),n},t.prototype.appendTo=function(t){var n=this;return this.element?new Promise(function(r){n.updateTMPStorageSettings(),r(e.prototype.appendTo.call(n,t))}):Promise.reject("unable to mount")},t.prototype.updateTMPStorageSettings=function(){var e=JSON.parse(this.$window.localStorage.getItem("tmp.settings")),t=this.params.settings.hostSettings,n=e&&e.core||{},r=e&&e.host||{},o=t&&t.core||{};e=JSON.stringify(i({},e,{core:i({},n,o),host:i({},r,o)})),this.$window.localStorage.setItem("tmp.settings",e)},t.prototype._sendCommand=function(e){var t=i({},e,{channel:this.constants.multiWindow.channel,metaData:{destination:{channel:e.eventId}}});this.element.contentWindow.postMessage(t,this.origin)},t}(n(224).ExperienceContainer);t.IframeExperienceContainer=s},2214:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.logger=e,this.handlers=new Map}return e.prototype.publish=function(e){for(var t=this,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];var i=this.handlers.get(e)||[];this.logger.debug("Publishing event "+e+" to "+i.length+" subscribers with following args",n),i.forEach(function(e){try{e.apply(void 0,n)}catch(e){t.logger.warn("Unable to publish event to handler because it threw the following error: "+e)}})},e.prototype.addEventListener=function(e,t){var n=this.handlers.get(e)||[];n.push(t),this.handlers.set(e,n)},e.prototype.removeEventListener=function(e,t){var n=this.handlers.get(e)||[];n=n.filter(function(e){return e!==t}),this.handlers.set(e,n)},e}();t.EventPublisher=r},2215:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(33),o=n(89),a=function(e){function t(t,n,r,i,o,a){var s=e.call(this,t.newLogger("WebViewExperienceContainer"),n,r,o,i)||this;return s.eventingService=a,s}return r(t,e),t.prototype.createElement=function(e){var t=this,n=this.logger.service.findScenario(this.constants.experienceContainers.scenarios.init);try{var r=o.htmlFactory.createWebView(this.elementId);return r.src=e,r.setAttribute("class","embedded-electron-webview embedded-page-content"),r.setAttribute("webpreferences","nativeWindowOpen=yes, sandbox=yes"),r.setAttribute("allowpopups",""),r.addEventListener("ipc-message",function(e){if(e.channel===t.constants.experienceContainers.channel){var r=e.args&&e.args[0];if(!r)return void t.logger.error("Invalid webview ipc-message - received no args.");if(r.requestRendererId=t.elementId,t.publish("message",r),r.eventId){if(r.eventId===i.ChildWindowEventRequest.CoreInitialized&&(t.logger.info("Received CoreInitialized event, changing state to loaded"),t._loaded=!0,n&&n.stop({reason:i.ChildWindowEventRequest.CoreInitialized})),r.eventId===i.ChildWindowEventRequest.ExperienceStarted&&t.logger.info("Received ExperienceStarted event"),r.eventId===i.ChildWindowEventRequest.CommandComplete){var o=r.payload,a=o.correlationId,s=o.commandStatus,c=o.errorInfo,p=t.logger.service.findScenarioByNameAndId(t.constants.multiWindow.scenario.enqueueEntityCommand,a);p||t.logger.warn("Received commandComplete event, but could not find a corresponding scenario"),"Failure"===s?p&&p.fail({reason:s,errorInfo:c}):p&&p.stop({reason:s})}t.publish(r.eventId,r.payload)}}}),r.addEventListener("crashed",function(){t.logger.error("Experience container with Id "+t.elementId+" has crashed"),t.eventingService.$emit(t.constants.events.experienceContainers.crashed,{id:t.elementId}),t.publish("crashed")}),r.addEventListener("did-fail-load",function(e){t.logger.error("Experience container with Id "+t.elementId+" failed to load. Url="+t.params.url+" Error="+e.errorDescription+" ("+e.errorCode+")"),t.publish("failed-to-load",e)}),r}catch(e){throw this.logger.error("Experience container with Id "+this.elementId+" loading exception: "+e),n&&n.fail({reason:this.constants.experienceContainers.reason.webViewEcCreateElementFailed}),e}},t.prototype.appendTo=function(t){var n=this;return this.element?new Promise(function(r){var i={enablePreload:!0,isExperienceRenderer:!0,rendererContext:JSON.stringify(n.params.settings||{})};n.$window.electronSafeIpc.send(n.constants.events.desktopApp.allowWebViewCreate,i),n.$window.electronSafeIpc.once(n.constants.events.desktopApp.webViewCreationEnabled,function(){n.logger.info("Received webViewCreationEnabled event, Appending webview element to the page"),r(e.prototype.appendTo.call(n,t).catch(function(e){return n.logger.warn("Failed to append webview element to the page: "+e)}))})}):Promise.reject(this.constants.experienceContainers.reason.ecAppendToError)},t.prototype._sendCommand=function(e){this.element.send(this.constants.experienceContainers.channel,e)},t}(n(224).ExperienceContainer);t.WebViewExperienceContainer=a},2216:function(e,t,n){"use strict";function r(e){var t=e.reason;return"crashed"===t||"failed-to-load"===t}function i(e){return!!e.factory}var o=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),a=this&&this.__assign||function(){return(a=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var s=n(33),c=n(89),p=n(2217),d=n(2218),l=function(){function e(e,t,n,r,i,o,a){var s=this;this.params=e,this.experienceContainerFactory=t,this.loggingService=n,this.serviceWrapper=r,this.onTearDownCallback=i,this.constants=o,this.logger=a,this.onTearDown=function(e,t){s.tearDownListeners(),s.shellCommWrapper.tearDown(),s.onTearDownCallback(s,{data:t,reason:e})},this.onCrashed=function(){return s.onTearDown("crashed")},this.onFailedToLoad=function(e){return s.onTearDown("failed-to-load",e&&{errorDescription:e.errorDescription,statusCode:e.errorCode})},this.onReloaded=function(){return s.onTearDown("reloaded")};var p=t.create(e);this.experienceContainer=p,this.setupListeners(),this.outerWrap=c.htmlFactory.createDiv("ExperienceContainerWrap-"+p.elementId),this.shellCommWrapper=new d.ShellCommWrapper(p,n,r),this.outerWrap.setAttribute("class","hidden");var l=n.findScenario(o.experienceContainers.scenarios.init);p.appendTo(this.outerWrap).then(function(){l&&l.mark(o.experienceContainers.step.constructContainerEntry)}).catch(function(e){a.error("Failed to append experience container to wrapper",e),l&&l.fail({reason:o.experienceContainers.reason.constructContainerEntryFailed})})}return e.prototype.setupListeners=function(){this.experienceContainer.addEventListener("crashed",this.onCrashed),this.experienceContainer.addEventListener("failed-to-load",this.onFailedToLoad),this.experienceContainer.addEventListener(s.ChildWindowEventRequest.WindowUnloaded,this.onReloaded)},e.prototype.tearDownListeners=function(){this.experienceContainer.removeEventListener("crashed",this.onCrashed),this.experienceContainer.removeEventListener("failed-to-load",this.onFailedToLoad),this.experienceContainer.removeEventListener(s.ChildWindowEventRequest.WindowUnloaded,this.onReloaded)},e}(),u=function(e){function t(t,n,r,i,o,s,c,d,l){var u=e.call(this,t)||this;return u.loggingService=n,u.experienceContainerFactory=r,u.constants=i,u.desktopUtilityService=o,u.settingsService=s,u.experienceContainerFeatureService=c,u.$window=d,u.onNewCallbacks=[],u.containers=new Map,u.recreateAttempts=0,u.lastRecreatedTime=0,u.onTearDown=function(e,t){if(u.logger.warn("Tearing down "+e.experienceContainer.elementId+" because it has "+t.reason+"."),u.settingsService.valueAsBoolean(u.constants.settings.names.enableAutoBRBforERCrashes)&&e.params&&e.params.url&&e.params.url.includes("teams.microsoft.com/")&&"crashed"===t.reason&&0===u.recreateAttempts&&u.logger.error("MultiWindow ExperienceRenderer Crashed or Failed to Load, so triggering AutoBRB"),u.remove(e,t),u.shouldRecreate(e,t)){var n=u.loggingService.findScenario(u.constants.experienceContainers.scenarios.init);n&&n.mark(u.constants.experienceContainers.step.ecmOnTearDownRecreate,a({recreateAttempts:u.recreateAttempts,reason:t.reason},t.data)),u.lastRecreatedTime=Date.now(),u.register(e.params)}else u.markTearDownScenario(t)},u.mountElement=u.createAndMountElement(),u.serviceWrapper=new p.ServiceWrapper(i,l,d,c),u.serviceWrapper.initialize(),u.logger=n.newLogger("ExperienceContainerManager"),u.initializeOnAppLaunchAndReinit("constructor"),d.addEventListener("unload",function(){u.cleanupOnAppTeardown("shutdown"),n.flush()}),u}return o(t,e),t.$inject=["orchestrationService","loggingService","experienceContainerFactory","constants","desktopUtilityService","settingsService","experienceContainerFeatureService","$window","$injector"],t.prototype.mtmaTelemetryIdentifier=function(){return"ExperienceContainerManager"},t.prototype.initializeOnAppLaunchAndReinit=function(e){var t=this,n=this.loggingService.findScenario(this.constants.experienceContainers.scenarios.init);if(this.isEnabled())try{var r=this.settingsService.valueAsObject(this.constants.settings.names.experienceContainers);Object.keys(r).forEach(function(e){var i=r[e];t.logger.info("Registering '"+e+"' experience container with options: {0}",i),n&&n.mark(t.constants.experienceContainers.step.ecmAppLaunchRegister,{reason:JSON.stringify(i),config:e}),t.register(t.getDefaultContainerParams(i))})}catch(e){this.logger.error("Failed to initialize some containers",e),n&&n.fail({reason:this.constants.experienceContainers.reason.ecmAppLaunchFailed})}else n&&n.fail({reason:this.constants.experienceContainers.reason.notEnabledDuringEcmAppLaunch})},t.prototype.cleanupOnAppTeardown=function(e){for(;this.containers.size>0;){var t=this.containers.entries().next().value,n=t[0],r=t[1];i(r)||(this.remove(r,{reason:e}),this.markTearDownScenario({reason:e})),this.containers.delete(n)}this.recreateAttempts=0,this.lastRecreatedTime=0,"shutdown"===e&&this.onNewCallbacks.splice(0)},t.prototype.isEnabled=function(){return this.experienceContainerFeatureService.isExperienceContainerSupportEnabled()},t.prototype.getDefaultContainerParams=function(e){var t=this.desktopUtilityService.isElectron()?"electron":"web",n=new URL(e.baseUrl);n.searchParams.append("agent",t);var r=this.$window.desktopSettings&&this.$window.desktopSettings.experienceRendererBuildContainer;return r?n.searchParams.append("container",r):n.searchParams.append("version",this.getVersion()),{url:n.href,types:e.types}},t.prototype.getDefaultContainerSettings=function(e){return{windowId:"northstarCore",hostSettings:this.serviceWrapper.getHostSettings({timeOpened:Date.now(),content:{id:e,metaData:{}}}),perfMarkers:{windowCreateTimeFromMainRenderer:Date.now()},loadUrl:e}},t.prototype.getVersion=function(){return this.settingsService.getOrbitalVersion(this.constants.settings.orbitals.multiWindow)},t.prototype.register=function(e){var t=this;e.types.forEach(function(n){return t.containers.set(n,t.createContainerFactory(e))})},t.prototype.getContainerEntry=function(e){var t=this.containers.get(e);if(t)return i(t)&&(t=t.factory()),t;this.recreateAttempts<2&&this.logger.error("Unknown container type '"+e+"'. You need to call register first.")},t.prototype.get=function(e){if(this.isEnabled()){var t=this.getContainerEntry(e);return t&&t.experienceContainer}},t.prototype.getUiHandle=function(e){if(this.isEnabled()){var t=this.getContainerEntry(e);return t&&t.outerWrap}},t.prototype.onNewMultiWindowExperienceContainer=function(e){this.onNewCallbacks.push(e);var t=this.containers.get("multi-window");t&&!i(t)&&e()},t.prototype.notifyOnNewMultiWindowExperienceContainer=function(){this.onNewCallbacks.forEach(function(e){return e()})},t.prototype.createContainerFactory=function(e){var t=this;return{factory:function(){try{e.settings=t.getDefaultContainerSettings(e.url);var n=t.createContainerEntry(e);return t.add(n),n}catch(n){throw t.logger.error("Failed to create container entry",n,e),n}}}},t.prototype.createContainerEntry=function(e){return this.markCreateNewScenario(),new l(e,this.experienceContainerFactory,this.loggingService,this.serviceWrapper,this.onTearDown,this.constants,this.logger)},t.prototype.add=function(e){var t=this;this.logger.info("Adding EC '"+e.experienceContainer.elementId+"'"),e.params.types.forEach(function(n){return t.containers.set(n,e)}),this.mountElement.appendChild(e.outerWrap),e.params.types.includes("multi-window")&&this.notifyOnNewMultiWindowExperienceContainer()},t.prototype.remove=function(e,t){var n=this;this.logger.info("Removing EC '"+e.experienceContainer.elementId+"' with reason='"+t.reason+"'"),this.mountElement.removeChild(e.outerWrap),e.params.types.forEach(function(e){return n.containers.delete(e)})},t.prototype.shouldRecreate=function(e,t){var n=0;return"reloaded"===t.reason?(this.logger.info("Attempting to recreate the experience container after unloading."),!0):(n=Date.now()-this.lastRecreatedTime)>18e4?(this.logger.info("Attempting to recreate the experience container because the last attempt was made "+n+" ms ago, which is beyond the recreate limit time window: 180000 ms."),this.recreateAttempts=0,!0):this.recreateAttempts++<2?(this.logger.info("Attempting to recreate the experience container. Attempt #"+this.recreateAttempts+"."),!0):(this.logger.error("Maximum retries hit. Not attempting to recreate the experience container."),!1)},t.prototype.markCreateNewScenario=function(){var e=this.constants.experienceContainers.scenarios.createNew;this.loggingService.newScenario(e).stop()},t.prototype.markTearDownScenario=function(e){var t=e.data,n=e.reason,i=this.loggingService.findScenario(this.constants.experienceContainers.scenarios.init)||this.loggingService.newScenario(this.constants.experienceContainers.scenarios.tearDown);r(e)?i&&i.fail(a({reason:n,errorCode:n,retryAttempt:this.recreateAttempts},t)):i&&i.stop(a({reason:n,retryAttempt:this.recreateAttempts},t))},t.prototype.createAndMountElement=function(){var e=c.htmlFactory.createDiv("ExperienceContainerManagerMountElement");return e.setAttribute("class","experience-containers-root"),document.body.appendChild(e),e},t}(teamspace.services.MTMABase);t.ExperienceContainerManager=u,angular.module("teamspace.experienceContainerManager",["teamspace.orchestrationService","teamspace.loggingService","teamspace.experienceContainerFactory","teamspace.constants","teamspace.desktopUtilityService","teamspace.settingsService","teamspace.experienceContainerFeatureService"]).service("experienceContainerManager",u)},2217:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t,n,r,i){var o=e.call(this,t,n,r)||this;return o.experienceContainerFeatureService=i,o}return r(t,e),t.prototype.getHostSettings=function(t){var n={core:{enableMultiWindowV2:this.experienceContainerFeatureService.isExperienceContainerSupportEnabled()}},r=e.prototype.getHostSettings.call(this,t);try{r.default=i({},r.default)}catch(e){}return i({},r,n)},t}(n(215).AngularServiceWrapper);t.ServiceWrapper=o},2218:function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(33),o=function(){function e(e,t,n){var r=this;this.experienceContainer=e,this.serviceWrapper=n,this.messageHandler=function(e){var t=function(e){r.experienceContainer.sendCommand(e)};switch(e.eventId){case i.ChildWindowEventRequest.ExperienceStarted:r.logger.info("Received ExperienceStarted event");break;case i.ChildWindowEventRequest.AadGetToken:r.handleAadGetToken(e,t);break;case i.ChildWindowEventRequest.AadGetCurrentUser:r.handleAadGetCurrentUser(e,t);break;case i.ChildWindowEventRequest.GetStateData:r.handleGetStateData(e,t);break;case i.ChildWindowEventRequest.RequestShellToOpen:r.handleRequestShellToOpen(e,t);break;case i.ChildWindowEventRequest.WindowCrashed:case"windowErrored":r.handleWindowErrored(e)}},e.addEventListener("message",this.messageHandler),this.logger=t.newLogger("MWv2::ShellCommWrapper")}return e.prototype.tearDown=function(){this.experienceContainer.removeEventListener("message",this.messageHandler)},e.prototype.handleAadGetToken=function(e,t){var n=this;this.serviceWrapper.getAadToken(e.payload.resource,e.payload.claim?e.payload.claim:void 0).then(function(t){return n.buildResponse(e,{token:t})}).then(t).catch(function(e){return n.logger.error("Failed to handle AAD token",e)})},e.prototype.handleAadGetCurrentUser=function(e,t){var n=this;this.serviceWrapper.getAuthUser().then(function(t){return n.buildResponse(e,{authUser:t})}).then(t).catch(function(e){return n.logger.error("Failed to handle AadGetCurrentUser",e)})},e.prototype.handleGetStateData=function(e,t){var n,r=this;switch(e.payload.requestType){case"skypeToken":n=this.serviceWrapper.getSkypeToken().then(function(e){return{skypeTokenData:e}});break;case"hostSettings":n=Promise.resolve({hostSettings:this.serviceWrapper.getHostSettings({})})}n.then(function(t){return r.buildResponse(e,t)}).then(t).catch(function(e){return r.logger.error("Failed to handle GetStateData",e)})},e.prototype.handleRequestShellToOpen=function(e,t){var n=this;if(e){var r=void 0,i=e.payload.openType,o=e.payload.openHandler,a=e.payload.handlerParams;if(i&&o)switch(i){case teamspace.services.OpenType.OpenOnMainRenderer:r=Promise.resolve({opened:this.serviceWrapper.navigateMainWindow(o,a)});break;case teamspace.services.OpenType.OpenInNewChildWindow:r=Promise.resolve({opened:this.serviceWrapper.openWindow(o,a)});break;case teamspace.services.OpenType.OpenInNewChildWindowFallBackToMain:r=new Promise(function(e){var t=n.serviceWrapper.openWindow(o,a);return e(t?{opened:t}:{opened:n.serviceWrapper.navigateMainWindow(o,a)})})}r.then(function(t){return n.buildResponse(e,t)}).then(t).catch(function(e){return n.logger.error("Failed to handle RequestShellToOpen",e)})}},e.prototype.handleWindowErrored=function(e){var t=this,n=e.payload||{},r=n.errorMsg;if(n.showOops){var i=n.logs&&Array.isArray(n.logs)&&n.logs.length>0,o=i?"\nLogs emitted for a child window error:\n":"";this.logger.warn("Child window has hit an unrecovered errored state: errorMsg="+r+", errorCode="+n.errorCode+"."+o),n.errorStack&&this.logger.warn("Error Stack: "+n.errorStack),i&&n.logs.forEach(function(e){t.logger.warn(e.timeStamp+" "+e.levelName+" - "+e.message)})}},e.prototype.buildResponse=function(e,t){return r({},e,{payload:t||{}})},e}();t.ShellCommWrapper=o},2219:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(33),o=n(2220),a=function(e){function t(t,n,r,i){var o=e.call(this,t)||this;return o.experienceContainerManager=n,o.experienceContainerFeatureService=r,o.$window=i,o.initializeOnAppLaunchAndReinit("constructor"),o}return r(t,e),t.$inject=["orchestrationService","experienceContainerManager","experienceContainerFeatureService","$window"],Object.defineProperty(t.prototype,"experienceContainer",{get:function(){return this.experienceContainerManager.get("hybrid-app")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"experienceUiWrap",{get:function(){return this.experienceContainerManager.getUiHandle("hybrid-app")},enumerable:!0,configurable:!0}),t.prototype.initializeOnAppLaunchAndReinit=function(e){var t=this;if(this.isEnabled()){var n;this.ready=new Promise(function(e){return n=e});var r=function(){n(),t.experienceContainer.removeEventListener(i.ChildWindowEventRequest.CoreInitialized,r)};this.experienceContainer.addEventListener(i.ChildWindowEventRequest.CoreInitialized,r),this.experienceContainer.loaded&&r(),this.resizeObserver=new ResizeObserver(function(e){var n=e[0].contentRect;t.resizeUtil.setSize(n)}),this.resizeUtil=new o.HybridAppResizeUtil,this.startResizeAnimation(this.experienceUiWrap)}},t.prototype.mtmaTelemetryIdentifier=function(){return"HybridAppService"},t.prototype.cleanupOnAppTeardown=function(e){this.ready=void 0,this.resizeUtil=void 0,this.resizeSampleElement=void 0,this.isHidden=!0,this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=void 0)},t.prototype.show=function(e,t,n){void 0===n&&(n=!0);var r=Promise.resolve();return this.isEnabled()?(this.isHidden=!1,r=n?this.showCommand(e):Promise.resolve(),this.experienceUiWrap.setAttribute("class","visible overlay"),this.resizeSampleElement&&this.resizeSampleElement===t||(this.resizeSampleElement&&this.resizeObserver.disconnect(),this.resizeSampleElement=t,t&&this.resizeObserver.observe(t))):r=Promise.reject("Hybrid app service is disabled. Unable to show the provided command - "+JSON.stringify(e)),r},t.prototype.hide=function(){this.resizeSampleElement=void 0,this.isHidden=!0,this.experienceUiWrap.setAttribute("class","hidden"),this.resizeObserver.disconnect()},t.prototype.isEnabled=function(){return this.experienceContainer&&this.experienceUiWrap&&this.experienceContainerFeatureService.isHybridAppExperienceContainerEnabled()},t.prototype.showCommand=function(e){var t=this;return this.ready.then(function(){var n={eventId:"executeEntityCommand",payload:{entity:e.entity,command:e.command}};t.experienceContainer.sendCommand(n)})},t.prototype.startResizeAnimation=function(e){var t=this,n=$(e),r=function(e){if(t.isEnabled()&&!t.isHidden){var i=t.resizeUtil.getElementStyle(e);n.css(i)}t.$window.requestAnimationFrame(r)};this.$window.requestAnimationFrame(r)},t}(teamspace.services.MTMABase);t.HybridAppService=a,angular.module("teamspace.hybridAppServiceLazy",["teamspace.orchestrationService","teamspace.experienceContainerManager","teamspace.experienceContainerFeatureService"]).service("hybridAppServiceLazy",a)},2220:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){this.lastResizeTimestamp=0,this.RESIZE_INTERVAL=200}return e.prototype.setSize=function(e){this.height=e.height,this.width=e.width},e.prototype.getElementStyle=function(e){var t=this.getSize(),n=t.width,r=t.height,i=this.lastSetHeight!==n||this.lastSetWidth!==r,o=e-this.lastResizeTimestamp;return i?o>=this.RESIZE_INTERVAL?(this.lastSetHeight=r,this.lastSetWidth=n,this.lastResizeTimestamp=e,{transform:"none",width:n+"px",height:r+"px"}):{transform:"scale("+n/this.lastSetWidth+","+r/this.lastSetHeight+")"}:{transform:"none"}},e.prototype.getSize=function(){return{width:this.width,height:this.height}},e}();t.HybridAppResizeUtil=r},2221:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){this.experienceContainerManager=e,this.experienceContainerFeatureService=t}return e.$inject=["experienceContainerManager","experienceContainerFeatureService"],Object.defineProperty(e.prototype,"experienceContainer",{get:function(){return this.experienceContainerManager.get("multi-window")},enumerable:!0,configurable:!0}),e.prototype.isEnabled=function(){return this.experienceContainerFeatureService.isMultiWindowExperienceContainerEnabled()},e.prototype.hasExperienceContainer=function(){return!!this.experienceContainer&&this.experienceContainer.loaded},e.prototype.showEntity=function(e){var t=this;return new Promise(function(n){if(!t.hasExperienceContainer())return n({isSuccess:!1,resultCode:"exp-not-loaded"});if(!t.isEnabled())return n({isSuccess:!1,resultCode:"exp-not-enabled"});var r={eventId:"executeEntityCommand",payload:e};t.experienceContainer.sendCommand(r),n({isSuccess:!0,resultCode:"success"})})},e}();t.MultiWindowService=r,angular.module("teamspace.multiWindowV2ServiceLazy",["teamspace.experienceContainerManager","teamspace.experienceContainerFeatureService"]).service("multiWindowV2ServiceLazy",r)},2222:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var o=teamspace.services,a=function(e){function t(t,n,r,i,o,a,s){var c=e.call(this,t)||this;return c.experienceContainerManager=n,c.multiWindowV2ServiceLazy=r,c.loggingService=i,c.utilityService=o,c.constants=a,c.$window=s,c.logger=i.newLogger("MW::MultiWindowV2ServiceShim"),c.initializeOnAppLaunchAndReinit(),c}return r(t,e),t.$inject=["orchestrationService","experienceContainerManager","multiWindowV2ServiceLazy","loggingService","utilityService","constants","$window"],Object.defineProperty(t.prototype,"loaded",{get:function(){if(this.isTearDown)return!1;var e=this.getExperienceContainer();return!!e&&e.loaded},enumerable:!0,configurable:!0}),t.prototype.mtmaTelemetryIdentifier=function(){return"MultiWindowV2ServiceShim"},t.prototype.cleanupOnAppTeardown=function(e){this.numChildWindows=0,this.enabled=!0,this.isTearDown=!0,this.additionalEntryPointsEnabled=!1},t.prototype.initializeOnAppLaunchAndReinit=function(e){this.isTearDown=!1,this.additionalEntryPointsEnabled=!0},t.prototype.openWindow=function(e,t){var n,r=this;if(e instanceof o.CallChildWindowParams){if(!e.entityCommand)return this.logger.error("Attempting to open a call window without an entity command defined."),Promise.resolve({isSuccess:!1,resultCode:"window-no-cmd"});n=e.entityCommand}else if(e instanceof o.PlatformAppChildWindowParams){if(!e.entityCommand)return this.logger.error("Attempting to open a tab window without an entity command defined."),Promise.resolve({isSuccess:!1,resultCode:"tab-no-cmd"});n=e.entityCommand}else if(e instanceof o.DigitalSignageChildWindowParams)n={entity:{id:i=e.contentId,type:"digitalsignageplayer",action:"view"},command:{visibilityState:"show",stateTransition:"new",correlation:{id:e.childWindowSessionID,startTimestamp:e.timeOpened,source:"ExternalCommand-"+t}}};else{var i=e.contentId;n={entity:{id:i,type:"chats",action:"view"},command:{visibilityState:"show",stateTransition:"new",correlation:{id:e.childWindowSessionID,startTimestamp:e.timeOpened,source:"ExternalCommand-"+t}}}}if(n.command.correlation.id){var a=this.logger.service.newScenario(this.constants.multiWindow.scenario.enqueueEntityCommand);a.clientId=n.command.correlation.id,a.appendEventData({"EventInfo.CorrelationId":n.command.correlation.id,commandEntityType:n.entity.type,commandEntityAction:n.entity.action})}return this.multiWindowV2ServiceLazy.showEntity(n).then(function(n){return r.logger.info("MultiWindowV2ServiceLazy.showEntity",e,t),n.isSuccess,n})},t.prototype.findWindow=function(e){this.logger.info("MultiWindowV2ServiceLazy.findWindow",e);var t=this.getExperienceContainer();if(t&&e.windowId===t.elementId)return this.createChildWindowShim(t)},t.prototype.broadcastToAllWindows=function(e){if(this.logger.info("MultiWindowV2ServiceLazy.broadcastToAllWindows",e),e&&e.eventId){var t=this.getExperienceContainer();t&&t.sendCommand(e)}},t.prototype.requestToAllWindows=function(e,t){var n=this;return this.logger.info("MultiWindowV2ServiceLazy.requestToAllWindows",e,t),new Promise(function(r,o){if(e&&e.eventId){var a=n.getExperienceContainer();a||o("No experience container.");var s=function(t){a.removeEventListener(e.eventId,s);var o=[{event:i({},e,{payload:t}),childWindow:n.createChildWindowShim(a)}];r(o)};a.addEventListener(e.eventId,s),a.sendCommand(e),n.$window.setTimeout(function(){o("Request timed out to child windows.")},2*t)}else o("Invalid parameters given.")})},t.prototype.closeAllWindows=function(e){return this.logger.info("MultiWindowV2ServiceLazy.closeAllWindows",e),Promise.reject("Method not implemented")},t.prototype.subscribeForNewWindowEvents=function(e,t){var n=this;this.logger.info("MultiWindowV2ServiceLazy.subscribeForNewWindowEvents",e,t),this.experienceContainerManager.onNewMultiWindowExperienceContainer(function(){var e=n.getExperienceContainer();if(e){var r=n.createChildWindowShim(e);t(r)}else n.logger.error("onNewMultiWindowExperienceContainer called without a valid container")})},t.prototype.initializeLazyService=function(){var e=this;o.WindowParams.generateUuid=function(){return e.utilityService.generateUUID()}},t.prototype.createChildWindowShim=function(e){var t={windowId:e.elementId,windowRef:{postMessage:function(t){e.sendCommand(t)},addEventListener:function(n,r){e.addEventListener("message",function(e){e.eventId===n&&r(e,t)})},removeEventListener:function(){},flashTaskbarIcon:function(){},unflashTaskbarIcon:function(){},blur:function(){},close:function(){},focus:function(){},requestMessage:function(){},setBody:function(){},isValid:function(){return!0}},isFocused:!0,state:o.WindowState.Active,url:"stub",frame:void 0,timeOpened:void 0,type:void 0,content:void 0};return t},t.prototype.getExperienceContainer=function(){return this.multiWindowV2ServiceLazy.experienceContainer},t}(o.MTMABase);t.MultiWindowV2ServiceShim=a,angular.module("teamspace.multiWindowV2ServiceShim",["teamspace.orchestrationService","teamspace.experienceContainerManager","teamspace.multiWindowV2ServiceLazy","teamspace.loggingService","teamspace.utilityService"]).service("multiWindowV2ServiceShim",a)},224:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){function t(t,n,r,i,o){var a=e.call(this,t)||this;return a.logger=t,a.elementId=n,a.params=r,a.constants=i,a.$window=o,a._loaded=!1,a.element=a.createElement(r.url),a}return r(t,e),Object.defineProperty(t.prototype,"loaded",{get:function(){return this._loaded},enumerable:!0,configurable:!0}),t.prototype.appendTo=function(e){return this.element?(e.appendChild(this.element),Promise.resolve()):Promise.reject(this.constants.experienceContainers.reason.ecAppendToError)},t.prototype.sendCommand=function(e){this.sendTelemetryEvent(e);try{this._sendCommand(e)}catch(n){this.logger.error("sendCommand() failed - {0}",n);var t=this.logger.service.findScenarioByNameAndId(this.constants.multiWindow.scenario.enqueueEntityCommand,e.payload.command.correlation.id);t&&t.fail({reason:"sendCommand failed"})}},t.prototype.sendTelemetryEvent=function(e){var t=(e.payload&&e.payload.command||{correlation:{}}).correlation,n="executeEntityCommand"===e.eventId?this.logger.service.findScenarioByNameAndId(this.constants.multiWindow.scenario.createNewWindow,t.id):void 0;if(n){var r={correlationId:t.id,commandSource:t.source},i=r.correlationId,o=r.commandSource;n.stop({"EventInfo.CorrelationId":i,commandSource:o})}},t}(n(2214).EventPublisher);t.ExperienceContainer=i},33:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ExperienceContainerEventNames=teamspace.services.ExperienceContainerEventNames,t.ExperienceContainerType=teamspace.services.ExperienceContainerType,t.ExperienceCommand=teamspace.services.ExperienceCommand,t.ShowEntityResultCode=teamspace.services.ShowEntityResultCode,t.ChildWindowEventRequest=teamspace.services.ChildWindowEventRequest},89:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){}return e.prototype.createDiv=function(e){return this.createElement("div",e)},e.prototype.createWebView=function(e){return this.createElement("webview",e)},e.prototype.createIframe=function(e){return this.createElement("iframe",e)},e.prototype.createElement=function(e,t){var n=document.createElement(e);return n.id=t,n},e}();t.htmlFactory=new r}},[2211]);
//# sourceMappingURL=https://statics.teams.cdn.office.net/hashedjs/lazy-ng1-mod-experience-container-services.min.js-ba4f328e.map