set nocompatible
set t_Co=256
set hidden
set encoding=UTF-8
set clipboard^=unnamed,unnamedplus
set completeopt+=noinsert,menuone,preview

set autoindent
set smartindent
set shiftwidth=2
set tabstop=2
set softtabstop=2
set smarttab
set textwidth=120
set linebreak
set signcolumn=yes

set number relativenumber
set showmatch
set showcmd

set wildmenu
set wildmode=longest:full,full

set splitbelow
set splitright

set foldmethod=syntax
set nofoldenable
set foldlevel=1
set viewoptions+=localoptions

set mouse=a
augroup NO_CURSOR_MOVE_ON_FOCUS
	au!
	au FocusLost * let g:oldmouse=&mouse | set mouse=
	au FocusGained * if exists('g:oldmouse') | let &mouse=g:oldmouse | unlet g:oldmouse | endif
augroup END

set showbreak=¬\ 
set listchars=tab:│\ ,space:·,nbsp:▓,trail:░,eol:¶,precedes:<,extends:>

filetype plugin indent on
syntax on

highlight clear SpellBad
highlight SpellBad cterm=underline ctermfg=red
highlight clear SpellCap
highlight SpellCap cterm=underline ctermfg=red
highlight clear SpellRare
highlight SpellRare cterm=underline ctermfg=green
highlight clear SpellLocal
highlight SpellLocal cterm=underline ctermfg=blue
highlight Pmenu ctermbg=gray

map <C-h>     <C-w>h
map <C-j>     <C-w>j
map <C-k>     <C-w>k
map <C-l>     <C-w>l
map <C-left>  <C-w><left>
map <C-down>  <C-w><down>
map <C-up>    <C-w><up>
map <C-right> <C-w><right>

" https://stackoverflow.com/a/1037182
nnoremap <silent><esc> :noh<return><esc>
nnoremap <esc>^[ <esc>^[

nnoremap gb :ls<CR>:b 
nnoremap <C-space> :set list! list?<CR>
nnoremap <F4> :wa<CR>:make<CR>
nnoremap <F5> :w<CR>:!%:p<CR>

inoremap <c-space> <c-n>

tnoremap <Esc> <C-\><C-n>

augroup auto_save_view
	autocmd!
	autocmd BufWinLeave * set spellfile& " needed for spellcheck to work with view
	autocmd BufWinLeave * silent! mkview
	autocmd BufWinEnter * silent! loadview
augroup END

autocmd BufNewFile,BufRead *.ino set filetype=arduino
autocmd BufNewFile,BufRead docker-compose.{yaml,yml} set filetype=docker-compose
autocmd BufRead,BufNewFile *.md set filetype=markdown

autocmd FileType tex,plaintex,gitcommit,markdown setlocal spell
autocmd FileType yaml setlocal ts=2 sts=2 sw=2 expandtab
autocmd FileType python compiler pylint
autocmd FileType python nnoremap <buffer> <F4> :w<CR>:make %<CR>
autocmd FileType tex,plaintex nnoremap <F4> :w<CR>:VimtexCompile<CR>
autocmd FileType dockerfile nnoremap <buffer> <F4> :wa<CR>:!docker build -t build . && docker run --rm -it $(docker build -q .)<CR>
autocmd FileType docker-compose nnoremap <buffer> <F4> :wa<CR>:!docker-compose down; docker-compose up -d<CR>
autocmd FileType arduino nnoremap <buffer> <F4> :wa<CR>:!arduino -v --upload %<CR>

" https://vim.fandom.com/wiki/Automatically_open_the_quickfix_window_on_:make
autocmd QuickFixCmdPost [^l]* nested cwindow
autocmd QuickFixCmdPost    l* nested lwindow

let g:netrw_liststyle = 3
let g:netrw_banner = 0
let g:netrw_browse_split = 4
let g:netrw_altv = 1
let g:netrw_winsize = 16

" https://stackoverflow.com/a/5636941
function! ToggleVExplorer()
  if exists("t:expl_buf_num")
      let expl_win_num = bufwinnr(t:expl_buf_num)
      if expl_win_num != -1
          let cur_win_nr = winnr()
          exec expl_win_num . 'wincmd w'
          close
          exec cur_win_nr . 'wincmd w'
          unlet t:expl_buf_num
      else
          unlet t:expl_buf_num
      endif
  else
      exec '1wincmd w'
      Vexplore
      let t:expl_buf_num = bufnr("%")
  endif
endfunction
map <silent> <C-E> :call ToggleVExplorer()<CR>

packadd termdebug
let g:termdebug_wide = 1

let g:airline#extensions#tabline#enabled = 1
let g:airline_symbols_ascii = 1
let g:airline#extensions#tabline#formatter = 'unique_tail'

let g:vimtex_view_method = 'zathura'

set rtp+=/usr/bin/fzf

" These lines must be at the very end of the vimrc file.
" packloadall breaks nvim plugin loading
" packloadall
silent! helptags ALL
